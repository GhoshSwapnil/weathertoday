<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chivo:ital@1&family=Signika&family=Work+Sans:ital@1&display=swap" rel="stylesheet">

    <title>Weather App</title>
    <style>
        *{
             box-sizing: border-box;
             padding: 0;
             margin: 0;
             font-family:  'Signika', sans-serif;
        }
         .main{
             position: relative;
             background: url('Image/nightBackg.jpg') no-repeat center;
             background-size: cover;
             height: 100vh;
             width: 100vw;
             display: flex;
             justify-content: flex-start;
             align-items: center;
             flex-direction: column;
             font-size: large;
         }
    </style>
    
    <link rel="stylesheet" href="CSS/backg.css">
     <link rel="stylesheet" href="CSS/box.css">
     <link rel="stylesheet" href="CSS/boxLeft.css">
     <link rel="stylesheet" href="CSS/boxCenter.css">
     <link rel="stylesheet" href="CSS/boxBottom.css">
     <link rel="stylesheet" href="CSS/inputLoc.css">
     <link rel="stylesheet" href="CSS/responsiveMob.css">
</head>
<body>
    <div class="main">
        <div class="inputStyle">
            <img id= "srchIMG" src="Image/search.png" height="30vh" width="30vw" onclick="fetchLocLat(`from click`);" >
            <img id="gprs" src="https://img.icons8.com/office/80/000000/near-me.png" height="30vh" width="30vw" onclick="getLocation()" style="color: white;">
            <input id="loc" type="text" placeholder="Location...">
        </div>

        <div class="cloudA">
            <img class="cloud1"  src="Image/cloud.png">
            <img class="cloud2"  src="Image/cloud.png">
            <img class="cloud3"  src="Image/cloud.png">
            <img class="cloud4"  src="Image/cloud.png">
            <img class="cloud5"  src="Image/cloud.png">
            <img class="cloud6"  src="Image/cloud.png">
            <img class="cloud7"  src="Image/cloud.png">
            <img class="cloud8"  src="Image/cloud.png">
            <img class="cloud9"  src="Image/cloud.png">
            <img class="cloud10" src="Image/cloud.png">
        </div>
        <div id="boxx">

            <span id="ribon"></span>

            <p id="currLoc" style="text-align:center; margin-top: 2vh; font-size: x-large;"></p>

            <div class="top">
                <div class="middle">
                    <div class="ifo">
                        <img id="weather" src="">
                    </div>
                    <div class="tempIfo">
                        <div id="tempDisp"></div>
                    </div>
                </div>
            </div>

            <p id="mood" style="padding-bottom:.1vh;"></p>
            <div class="center">
                    <div  class="currC">
                         <img src="Image/minTemp.png" height="30vh" width="40vw">
                         <span id="Cmin"></span>
                    </div>

                    <div class="currC">
                         <img src="Image/maxTemp.png" height="30vh" width="40vw">
                         <span id="Cmax"></span>
                    </div>

                    <div class="currC">
                         <img src="Image/humidity.png" height="30vh" width="40vw">
                         <span id="Chum"></span>
                    </div>

                    <div class="currC">
                         <img src="Image/uv.png" height="30vh" width="40vw">
                         <span id="Cpres"></span>
                    </div>
            </div>

            <div id="upComing" class="upcomingDays">
            </div>
        </div>
    </div>
    <script>
         let weatherTeller= (ID) =>{
             if  (ID >= 200 && ID < 300){
                 //Thunderstorm
             }
             else if (ID >= 300 && ID < 500 ){
                 //Drizzle
             }
             else if (ID >= 500 && ID < 600 ){
                 //Rain
             }
             else if ( ID >= 600 && ID < 700  ){
                 //Snow
             }
             else if (ID >= 700 && ID < 800 ){
                 //Atmosphere
             }
             else if ( ID == 800 ){
                 //clear
             }
             else if ( ID >= 801 && ID < 805 ){
                //cloud
             }
             else{
                //Noting
             }
         }
         document.getElementById("boxx").style.display="none";

         document.getElementById("loc").addEventListener("keydown", ()=>{
              document.getElementById("srchIMG").style.left="0px";
              document.getElementById("srchIMG").style.animationPlayState='paused';
         } );

         const fetchData=(str, latitude, longitude) =>{

             let req= new XMLHttpRequest();

             let apiKey= "dd14a6b1b2d175bedd12c8e155e668cb";

             req.open("GET",`https://api.openweathermap.org/data/2.5/onecall?lat=${latitude}&lon=${longitude}&exclude=hourly,minutely&units=metric&appid=dd14a6b1b2d175bedd12c8e155e668cb`, true);
             
             req.onreadystatechange= function() {
                 if ( this.status > 200 ){
                     alert("Invalid Location, Enter a Valid Location");
                     document.getElementById("loc").value= "";
                     return;
                 }
                 if ( this.readyState == 4 && this.status == 200) {
                     document.getElementById("boxx").style.display="block";

                     let metaData= JSON.parse(this.responseText);

                     console.log(`from -> ${str}`);
                     console.log(metaData);

                     temp= `<p id="temppp" style=" opacity:0.8; font-size:4vmax;">
                                 ${Math.round(metaData.current.temp)}<sup style=" opacity:0.6; font-size:2vmax;">°C</sup>
                             </p>`;
                     
                     document.getElementById("currLoc").innerHTML=" ";

                     if ( name == "")
                         document.getElementById("currLoc").innerHTML=`<img src="Image/loc.png" height="30vh" width="30vw">${metaData.timezone}`;
                     else
                         document.getElementById("currLoc").innerHTML=`<img src="Image/loc.png" height="30vh" width="30vw">${name}`;
                     name="";

                     document.getElementById("tempDisp").innerHTML= temp;
                     
                     document.getElementById("mood").innerHTML=`<i>${metaData.daily[0].weather[0].description}</i>`;

                             let img="";
                             let D_N= ( metaData.current.uvi > 0 )? "Day" : "Night"; 
                             let ID= metaData.current.weather[0].id;
                             if  (ID >= 200 && ID < 300){
                                      img= "Image/animated/Thunderstorm.svg";
                             }
                            else if (ID >= 300 && ID < 500 ){
                                     img= "Image/animated/Drizzle.svg";
                            }
                            else if (ID >= 500 && ID < 600 ){
                                 if ( D_N == "Day")
                                     img= "Image/animated/Rain_D.svg";
                                 else
                                     img= "Image/animated/Rain_N.svg";
                            }
                            else if ( ID >= 600 && ID < 700  ){
                                 if ( D_N == "Day")
                                     img= "Image/animated/Snow_D.svg";
                                 else
                                     img= "Image/animated/Snow_N.svg";
                            }
                            else if (ID >= 700 && ID < 800 ){
                                 if ( D_N == "Day")
                                     img= "Image/animated/haze_D.svg";
                                 else
                                     img= "Image/animated/haze_N.svg";
                            }
                            else if ( ID == 800 ){
                                 if ( D_N == "Day")
                                     img= "Image/animated/clear_D.svg";
                                 else
                                     img= "Image/animated/clear_N.svg";
                            }
                            else if ( ID >= 801 && ID < 805 ){
                                 if ( D_N == "Day")
                                     img= "Image/animated/cloud_D.svg";
                                 else
                                     img= "Image/animated/cloud_N.svg";
                            }
                            else{
                                //Noting
                            }
                     document.getElementById("weather").src=`${img}`;
                    // document.getElementById("weather").src="Image/animated/Rain_N.svg";

                     document.getElementById("srchIMG").style.animationPlayState='running';

                     document.getElementById("Cmin").innerHTML=` ${Math.round(metaData.daily[0].temp.min)}<sup style="opacity:0.6; font-size:.8vmax;">°C</sup>`;
                     document.getElementById("Cmax").innerHTML=` ${Math.round(metaData.daily[0].temp.max)}<sup style="opacity:0.6; font-size:.8vmax;">°C</sup>`;

                     let {humidity, uvi}= metaData.current;
                     document.getElementById("Chum").innerText=` ${humidity}%`;
                     document.getElementById("Cpres").innerText=` ${uvi}`;

                     reff= document.getElementById("upComing");
                     let forcast= ``;

                     let day=["SUN", "MON", "TUE","WED","THU","FRI","SAT"];
                     const months= ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"];

                     const d= new Date();
                     i= d.getDay();
                     
                     let dt= d.getDate();
                     let m= d.getMonth()+ 1;
                     let date;
                     if ( dt == 1 || dt == 31){
                             date= dt+"st, "+ months[m-1];
                     }
                     else if ( dt == 2){
                             date= dt+"nd, "+ months[m-1];
                     }
                     else{
                             date= dt+"th, "+ months[m-1];
                     }

                     let ribonInside= document.getElementById("ribon");
                     ribonInside.setAttribute('date', `${date}`);

                     for ( let idx= 0; idx< 8; idx++){
                         if(idx == 0){
                              i= (i+ 1)%7;
                             continue;
                         }
                         else {
                             let img="";
                             let ID= metaData.daily[idx].weather[0].id;
                             if  (ID >= 200 && ID < 300){
                                      img= "Image/animated/Thunderstorm.svg";
                             }
                            else if (ID >= 300 && ID < 500 ){
                                     img= "Image/animated/Drizzle.svg";
                            }
                            else if (ID >= 500 && ID < 600 ){
                                     img= "Image/animated/Rain_D.svg";
                            }
                            else if ( ID >= 600 && ID < 700  ){
                                     img= "Image/animated/Snow_D.svg";
                            }
                            else if (ID >= 700 && ID < 800 ){
                                     img= "Image/animated/Atmosphere_D.svg";
                            }
                            else if ( ID == 800 ){
                                     img= "Image/animated/clear_D.svg";
                            }
                            else if ( ID >= 801 && ID < 805 ){
                                     img= "Image/animated/cloud_D.svg";
                            }
                            else{
                                //Noting
                            }
                            forcast+=`<div class="card">
                                         <p class="day">${day[i]}</p>
                                         <div class="geek">
                                              <img src="${img}">
                                         </div>
                                         <p class="moodC"><i>${metaData.daily[idx].weather[0].main}</i></p>
                                         <div class="dataN" style="margin-top:.5vh;">
                                             <div style="opacity:0.8; font-size:large;">${Math.round(metaData.daily[idx].temp.max)}<sup style="opacity:0.6; font-size:.8vmax;">°C</sup></div>
                                             <div style="opacity:0.8; font-size:large;">${Math.round(metaData.daily[idx].temp.min)}<sup style="opacity:0.6; font-size:.8vmax;">°C</sup></div>
                                         </div>
                                     </div>`
                                     i=( i+ 1)%7;
                         }
                     }
                    reff.innerHTML= forcast;
                   }
                }
                req.send();
            }
         document.getElementById("loc").addEventListener("keyup", (event) => {
             if (event.keyCode === 13){
                fetchLocLat(`from enter`);
             }
        });
         function getLocation() {
             if (navigator.geolocation) 
                 navigator.geolocation.getCurrentPosition(showPosition);
             else{
                 alert("Location Permission, Not Granted !!");
             }
         } 

         function showPosition(position) {
             console.log(`Latitude -> ${position.coords.latitude}\n Longitude ->  ${position.coords.longitude}`);
             fetchData(`from gprs`, position.coords.latitude, position.coords.longitude);
         }

         var name= ``;
         function fetchLocLat(str) {

             let place= document.getElementById("loc").value;

             if ( place.trim() == ""){
                 alert("Please Enter a Location before searching !!");
                 document.getElementById("loc").value= "";
                 return;
             }

             let req= new XMLHttpRequest();

             let apiKey= "dd14a6b1b2d175bedd12c8e155e668cb";

             req.open("GET",`https://api.openweathermap.org/data/2.5/weather?q=${place}&units=metric&appid=${apiKey}`, true);

             req.onreadystatechange= function() {
                 if ( this.status > 200 ){
                     alert("Entered Invalid Location !!");
                     document.getElementById("loc").value= "";
                     return;
                 }
                 if ( this.readyState == 4 && this.status == 200) {
                     let metaData= JSON.parse(this.responseText);

                     console.log(metaData);

                     
                     let T_place= place;
                     T_place= T_place.toLowerCase();
                     T_place= T_place.charAt(0).toUpperCase()+ T_place.substring(1);
                     name+= `${T_place}, ${metaData.sys.country}`;
                     T_place="";

                     lon= metaData.coord.lon;
                     lat= metaData.coord.lat;

                     fetchData(`${str}`, lat, lon);
                 }
                }
             req.send();
         }


         function myFunction(x) {
            if (x.matches) { // If media query matches
                document.getElementById("mood").style.display="none";
            } else {
                document.getElementById("mood").style.display="block";
            }
         }

            var x = window.matchMedia("(min-width: 941px)")
            myFunction(x) // Call listener function at run time
            x.addListener(myFunction) // Attach listener function on state changes
    </script>
</body>
</html>